#directory stuffs
SHELL = /bin/bash
TOP := $(shell pwd)
PYTHON=python3.6

#project stuffs
MAIN_PRJ ?= hello
PRJ_DIR ?= $(TOP)/upload

#board stuffs
BRD_IP?=192.168.2.99
BRD_DIR?=/home/xilinx/file
BRD_USR?=xilinx

.PHONY: all clean

help:
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo "           FPGA actions template makefile helper           "
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo ""
	@echo " [HELP] 'make' shows this helper"
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo " [INFO] 'make all'  clone and run files"
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo " default configuration: micro-usb addr 'BRD_IP?=$(BRD_IP)'"
	@echo " default target directory on the board 'BRD_DIR?=$(BRD_DIR)'"
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo "                     Clone files                             "
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo "[INFO] 'make copy_py' clone python file in the 'file' folder"
	@echo "[INFO] 'make copy_bit' clone python file in the 'file' folder"
	@echo "[INFO] 'make copy' clone all files in the 'file' folder"
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo "                     Clean utilities                             "
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo "[INFO] 'make clean' cleans everything in the folder on board"
	@echo ""
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo ""
	@echo "            End of FPGA actions template makefile helper       "
	@echo ""
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@echo "*****************************************************************"
	@make helparam

############################################################################################################
############################################### COPY #######################################################
############################################################################################################

copy_py:
	rsync -avz $(PRJ_DIR)/$(MAIN_PRJ).py $(BRD_USR)@$(BRD_IP):$(BRD_DIR)
copy_bit:
	rsync -avz $(PRJ_DIR)/$(MAIN_PRJ).bit $(BRD_USR)@$(BRD_IP):$(BRD_DIR)

copy: copy_py copy_bit


############################################################################################################
################################################ RUN #######################################################
############################################################################################################

run_py:
	ssh $(BRD_USR)@$(BRD_IP) '$(PYTHON) $(BRD_DIR)/$(MAIN_PRJ).py'

run_bit:
	ssh $(BRD_USR)@$(BRD_IP) '$(BRD_DIR)/$(MAIN_PRJ).bit'
	
#return:
##################
#####TO DO########
##################

all: copy run_py  


############################################################################################################
############################################### CLEAN ######################################################
############################################################################################################

clean:
	ssh $(BRD_USR)@$(BRD_IP) 'rm $(BRD_DIR)/*.py'
	ssh $(BRD_USR)@$(BRD_IP) 'rm $(BRD_DIR)/*.bit'

helparam:
	@echo ""
	@echo "*****************************************************************"
	@echo "" 
	@echo "                 Makefile parameters  helpers               "
	@echo ""
	@echo "*****************************************************************"
	@echo ""
	@echo " [INFO] using shell=$(SHELL), top directory=$(TOP)"
	@echo " [INFO] py version=$(PYTHON)"
	@echo ""
	@echo "*****************************************************************"
	@echo "" 
	@echo "               END of Makefile parameters helper                     "
	@echo ""
	@echo "*****************************************************************"
	@echo ""